!function(i){"use strict";i.elysiumShop={options:{},init:function(i){this.options=i,this.initMain(),this.initLazyLoading(),this.initGridList()},initMain:function(){i("#selectPrductSort option").click(function(){location.assign(i(this).val())}),i("#nb_item").change(function(){i(this).val()?i.cookie("products_per_page",i(this).val(),{expires:30,path:"/"}):i.cookie("products_per_page","",{expires:0,path:"/"}),location.reload()}),i(".dialog").on("click","a.dialog-close",function(){return i(this).closest(".dialog").hide().find(".cart").empty(),!1}),i(document).keyup(function(t){27==t.keyCode&&i(".dialog:visible").hide().find(".cart").empty()}),i("#center_column").on("submit",".product-list form.addtocart",function(){var t=i(this);if(t.data("url")){var e=i("#dialog"),o=e.find(".cart");return o.load(t.data("url"),function(){o.prepend('<a href="#" class="dialog-close">&times;</a>'),e.show(),o.height()>o.find("form").height()?o.css("bottom","auto"):o.css("bottom","15%")}),!1}return i.post(t.attr("action")+"?html=1",t.serialize(),function(e){if("ok"==e.status){var o=i(".cart-total");if(i(window).scrollTop()>=35&&o.closest("#cart").addClass("fixed"),o.closest("#cart").removeClass("empty"),i("table.cart").length)i(".content").parent().load(location.href,function(){o.html(e.data.total)});else{if("table"==t.closest(".product-list").get(0).tagName.toLowerCase())var a=t.closest("tr"),s=i("<div></div>").append(i("<table></table>").append(a.clone()));else var a=t.closest("li"),s=i("<div></div>").append(a.html());s.css({"z-index":10,top:a.offset().top,left:a.offset().left,width:a.width()+"px",height:a.height()+"px",position:"fixed",overflow:"hidden"}).insertAfter(a).animate({top:o.offset().top,left:o.offset().left,width:0,height:0,opacity:.5},500,function(){i(this).remove(),o.html(e.data.total)})}e.data.error&&alert(e.data.error)}else"fail"==e.status&&alert(e.errors)},"json"),!1}),i(".filters.ajax form input").change(function(){var t=i(this).closest("form"),e="?"+t.serialize();i(window).lazyLoad&&i(window).lazyLoad("sleep"),i.get(e,function(t){var o=i("<div></div>").html(t);i("#product-list").html(o.find("#product-list").html()),history.pushState&&void 0!==history.state&&window.history.pushState({},"",e),i(window).lazyLoad&&i(window).lazyLoad("reload"),i(".compare .comparator").uniform(),i("ul.product_view").each(function(t){var e=i.cookie("tabCookie"+t);e&&i(this).find("li").eq(e).addClass("current").siblings().removeClass("current").parents("#center_column").find("#product_list").addClass("list").removeClass("grid").eq(e).addClass("grid").removeClass("list")})})}),i("#layered_form span.layered_close a").live("click",function(t){'<i class="icon-plus-sign"></i>'==i(this).html()?(i("#"+i(this).attr("rel")).show(600),i(this).html('<i class="icon-minus-sign"></i>'),i(this).parent().removeClass("closed"),i.cookie("layered_form_"+i(this).attr("rel"),"open")):(i("#"+i(this).attr("rel")).hide(600),i(this).html('<i class="icon-plus-sign"></i>'),i(this).parent().addClass("closed"),i.cookie("layered_form_"+i(this).attr("rel"),"close")),t.preventDefault()}),i("#layered_form span.layered_close a").each(function(){"close"==i.cookie("layered_form_"+i(this).attr("rel"))&&(i("#"+i(this).attr("rel")).hide(600),i(this).html('<i class="icon-plus-sign"></i>'),i(this).parent().addClass("closed"))}),i("#product-gallery").bxSlider({pager:!1,controls:!0,minSlides:1,maxSlides:4,slideWidth:80,infiniteLoop:!1,moveSlides:1,nextText:"",prevText:""}),i(".accordion-tabs").children("li").first().children("a").addClass("is-active").next().addClass("is-open").show(),i(".accordion-tabs").children("li").first().children("a").find(".column_icon_toggle").removeClass("icon-plus-sign"),i(".accordion-tabs").on("click","li > a",function(t){i(this).hasClass("is-active")?t.preventDefault():(t.preventDefault(),i(".accordion-tabs .is-open").removeClass("is-open").hide(),i(this).next().toggleClass("is-open").toggle(),i(".accordion-tabs").find(".is-active").removeClass("is-active"),i(".accordion-tabs").find(".column_icon_toggle").addClass("icon-plus-sign"),i(this).addClass("is-active"),i(this).find(".column_icon_toggle").removeClass("icon-plus-sign"))})},initFilterSlider:function(){return this.options.filter_slider?(i("#filter-slider").slider({range:!0,min:this.options.filter_slider_min_value,max:this.options.filter_slider_max_value,values:[this.options.filter_slider_min_price,this.options.filter_slider_max_price],slide:function(t,e){var o=e.values[0];o==i(this).slider("option","min")&&(o=""),i('.filters input[name="price_min"]').val(o),o=e.values[1],o==i(this).slider("option","max")&&(o=""),i('.filters input[name="price_max"]').val(o)},stop:function(){i('input[name="price_min"]').change()}}),void i(".filters input[name=price_min], .filters input[name=price_max]").change(function(){var t=parseFloat(i(".filters input[name=price_min]").val());t||(t=i("#filter-slider").slider("option","min"));var e=parseFloat(i(".filters input[name=price_max]").val());e||(e=i("#filter-slider").slider("option","max")),e>=t&&i("#filter-slider").slider("option","values",[t,e])})):!1},initElevateZoom:function(){return this.options.elevate_zoom?(i("#product-image").elevateZoom({zoomType:"window",cursor:"crosshair",zoomWindowFadeIn:500,zoomWindowFadeOut:750,gallery:"product-gallery",galleryActiveClass:"thumbActive",zoomWindowWidth:400,borderSize:1,borderColour:"#e5e5e5",lensOpacity:.7,scrollZoom:!0,constrainType:"width"}),void i("#product-image").bind("click",function(){var t=i("#product-image").data("elevateZoom");return i.fancybox(t.getGalleryList()),!1})):!1},initLazyLoading:function(){if(!this.options.lazyloading)return!1;var t=i(".lazyloading-paging");if(t.length){var e=t.find("li.selected");if("1"==e.children("a").text()){t.hide();var o=i(window);o.lazyLoad("stop");var a=e.next();a.length&&o.lazyLoad({container:"#center_column",load:function(){o.lazyLoad("sleep");var t=i(".lazyloading-paging").hide(),e=t.find("li.selected"),a=e.next(),s=a.find("a").attr("href");if(!s)return void o.lazyLoad("stop");var r=i("#product-list .product-list"),l=t.parent().find(".loading").parent();l.length||(l=i('<div><i class="icon16 loading"></i>Loading...</div>').insertBefore(t)),l.show(),i.get(s,function(e){var a=i("<div></div>").html(e);r.append(a.find("#product-list .product-list").children());var s=a.find(".lazyloading-paging").hide();t.replaceWith(s),t=s;var n=t.find("li.selected"),d=n.next();o.lazyLoad(d.length?"wake":"stop"),l.hide(),a.remove(),i(".compare .comparator").uniform()})}})}}},initGridList:function(){var t=this;i("ul.product_view").each(function(e){var o=i.cookie("tabCookie"+e)||t.options.default_product_view;o&&i(this).find("li").eq(o).addClass("current").siblings().removeClass("current").parents("#center_column").find("#product_list").addClass("list").removeClass("grid").eq(o).addClass("grid").removeClass("list")}),i("ul.product_view").delegate("li:not(.current)","click",function(t){i(this).addClass("current").siblings().removeClass("current").parents("#center_column").find("#product_list").removeClass("grid").addClass("list").eq(i(this).index()).addClass("grid").removeClass("list");var e=i.cookie("tabCookie"+t);e&&i(this).find("#product_list").eq(e).removeClass("grid").addClass("list").siblings().removeClass("list");var o=i("ul.product_view").index(i(this).parents("ul.product_view"));i.cookie("tabCookie"+o,null),i.cookie("tabCookie"+o,i(this).index(),{expires:365,path:"/"})})},initCompare:function(){i(".comparator").poshytip({followCursor:!0,className:"tip-darkgray",showOn:"hover",alignTo:"target",alignX:"inner-left",offsetX:0,offsetY:5});var t=this;i(".comparator").change(function(){var e=i.cookie("shop_compare");if(i(this).prop("checked")){if(e?e+=","+i(this).val():e=""+i(this).val(),i(this).poshytip("update",t.options.remove_from_compare),e.split(",").length>1){var o=i("#bt_compare_bottom").attr("href").replace(/compare\/.*$/,"compare/"+e+"/");i("#bt_compare_bottom").attr("href",o).show(),i(this).poshytip("update",'<a style="color:#FFF; text-decoration:underline;" href="'+i("#bt_compare_bottom").attr("href")+'">Сравнить '+e.split(",").length+"</a>",!0)}i(this).closest("p").find("label").text(t.options.remove_from_compare),i.cookie("shop_compare",e,{expires:30,path:"/"})}else{e=e?e.split(","):[];var a=i.inArray(i(this).val()+"",e);if(-1!=a&&e.splice(a,1),e.length>1){var o=i("#bt_compare_bottom").attr("href").replace(/compare\/.*$/,"compare/"+e+"/");i("#bt_compare_bottom").attr("href",o)}else i("#bt_compare_bottom").hide();e?i.cookie("shop_compare",e.join(","),{expires:30,path:"/"}):i.cookie("shop_compare",null),i(this).poshytip("update",t.options.add_to_compare),i(this).closest("p").find("label").text(t.options.add_to_compare)}return!1})}}}(jQuery);